<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" >
  <head>
    <meta http-equiv="Content-Type" content="text/xml; charset=utf-8" />
    <meta name="description" content="Jeremiah's Coding Blog" />
    <meta name="keywords" content="Jeremiah, LaRocco, programming, books, coding, Lisp, C++" />
    <meta name="robots" content="index, follow" />
    <link rel="stylesheet" href="./pagestyles.css" type="text/css" />
    <title>Jeremiah's Coding Blog</title>
  </head>
  <body>
    <div class="navigation">
      <div class="navItem"><a href="http://github.com/jl2">Github</a></div>
      <div class="navItem"><a href="http://www.laroccophoto.com">Photography</a></div>
      <div class="navItem"><a href="https://500px.com/jlarocco">500px</a></div>
      <div class="navItem"><a href="https://pinboard.in/u:jlarocco/">Pinboard</a></div>
      <div class="navItem"><a href="https://vimeo.com/user5403988">Vimeo</a></div>
      <div class="navItem"><a href="https://soundcloud.com/jlarocco">SoundCloud</a></div>
      <div class="navItem"><a href="http://www.flickr.com/photos/jl_2">Flickr</a></div>
    </div>

    <div class="pageBody">
      <div class="pageEntry">
        <div class="section_header">
          <span class="date">November 29, 2015</span>
          <span class="title">Make Static Gist with Lisp</span>
        </div>
        <p> 
          Here's a Common Lisp function to generate static HTML and CSS from a GitHub Gist URL.  The 
          results are printed to standard out, and can be copy/pasted into an HTML document.  This is
          really useful when working in Emacs with a Slime REPL open.
        </p>
        <div id="gist28476230" class="gist">
          <div class="gist-file">
            <div class="gist-data">
              <div class="js-gist-file-update-container js-task-list-container file-box">
                <div id="file-make-static-gist-lisp" class="file">
                  

                  <div class="blob-wrapper data type-common-lisp">
                    <table class="highlight tab-size js-file-line-container" data-tab-size="8">
                      <tr>
                        <td id="file-make-static-gist-lisp-L1" class="blob-num js-line-number" data-line-number="1"></td>
                        <td id="file-make-static-gist-lisp-LC1" class="blob-code blob-code-inner js-file-line">(<span class="pl-k">defun</span> <span class="pl-en">make-static-gist</span> (gist-url) </td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L2" class="blob-num js-line-number" data-line-number="2"></td>
                        <td id="file-make-static-gist-lisp-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">&quot;</span>Retrieve a Gist from GitHub and format it as static CSS and HTML.<span class="pl-pds">&quot;</span></span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L3" class="blob-num js-line-number" data-line-number="3"></td>
                        <td id="file-make-static-gist-lisp-LC3" class="blob-code blob-code-inner js-file-line">  (<span class="pl-k">let</span>* ((nl-string (<span class="pl-c1">format</span> <span class="pl-c1">nil</span> <span class="pl-s"><span class="pl-pds">&quot;</span>~c<span class="pl-pds">&quot;</span></span> <span class="pl-c1">#\newline</span>))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L4" class="blob-num js-line-number" data-line-number="4"></td>
                        <td id="file-make-static-gist-lisp-LC4" class="blob-code blob-code-inner js-file-line">         <span class="pl-c">;; Make sure the url has &quot;.js&quot; on the end</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L5" class="blob-num js-line-number" data-line-number="5"></td>
                        <td id="file-make-static-gist-lisp-LC5" class="blob-code blob-code-inner js-file-line">         (ending (subseq gist-url (- (length gist-url) <span class="pl-c1">3</span>)))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L6" class="blob-num js-line-number" data-line-number="6"></td>
                        <td id="file-make-static-gist-lisp-LC6" class="blob-code blob-code-inner js-file-line">         (js-url (<span class="pl-k">if</span> (string= ending <span class="pl-s"><span class="pl-pds">&quot;</span>.js<span class="pl-pds">&quot;</span></span>)</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L7" class="blob-num js-line-number" data-line-number="7"></td>
                        <td id="file-make-static-gist-lisp-LC7" class="blob-code blob-code-inner js-file-line">                     gist-url</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L8" class="blob-num js-line-number" data-line-number="8"></td>
                        <td id="file-make-static-gist-lisp-LC8" class="blob-code blob-code-inner js-file-line">                     (concatenate &#39;string gist-url <span class="pl-s"><span class="pl-pds">&quot;</span>.js<span class="pl-pds">&quot;</span></span>)))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L9" class="blob-num js-line-number" data-line-number="9"></td>
                        <td id="file-make-static-gist-lisp-LC9" class="blob-code blob-code-inner js-file-line">         <span class="pl-c">;; Fetch the embedded gist from GitHub</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L10" class="blob-num js-line-number" data-line-number="10"></td>
                        <td id="file-make-static-gist-lisp-LC10" class="blob-code blob-code-inner js-file-line">         (gist-data (drakma:http-request js-url)))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L11" class="blob-num js-line-number" data-line-number="11"></td>
                        <td id="file-make-static-gist-lisp-LC11" class="blob-code blob-code-inner js-file-line">    <span class="pl-c">;; Read the string data</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L12" class="blob-num js-line-number" data-line-number="12"></td>
                        <td id="file-make-static-gist-lisp-LC12" class="blob-code blob-code-inner js-file-line">    (with-input-from-string (strm gist-data)</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L13" class="blob-num js-line-number" data-line-number="13"></td>
                        <td id="file-make-static-gist-lisp-LC13" class="blob-code blob-code-inner js-file-line">      (<span class="pl-k">let</span>* (</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L14" class="blob-num js-line-number" data-line-number="14"></td>
                        <td id="file-make-static-gist-lisp-LC14" class="blob-code blob-code-inner js-file-line">             <span class="pl-c">;; Get the CSS link</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L15" class="blob-num js-line-number" data-line-number="15"></td>
                        <td id="file-make-static-gist-lisp-LC15" class="blob-code blob-code-inner js-file-line">             (css-html (read-line strm))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L16" class="blob-num js-line-number" data-line-number="16"></td>
                        <td id="file-make-static-gist-lisp-LC16" class="blob-code blob-code-inner js-file-line">             <span class="pl-c">;; Get the document data</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L17" class="blob-num js-line-number" data-line-number="17"></td>
                        <td id="file-make-static-gist-lisp-LC17" class="blob-code blob-code-inner js-file-line">             (doc-part (read-line strm))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L18" class="blob-num js-line-number" data-line-number="18"></td>
                        <td id="file-make-static-gist-lisp-LC18" class="blob-code blob-code-inner js-file-line">             <span class="pl-c">;; Parse out the CSS URL and fetch it</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L19" class="blob-num js-line-number" data-line-number="19"></td>
                        <td id="file-make-static-gist-lisp-LC19" class="blob-code blob-code-inner js-file-line">             <span class="pl-c">;; 45 is the length of &quot;document.write...&quot;,</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L20" class="blob-num js-line-number" data-line-number="20"></td>
                        <td id="file-make-static-gist-lisp-LC20" class="blob-code blob-code-inner js-file-line">             <span class="pl-c">;; 4 is the length of &quot;&quot;);&quot; on the end</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L21" class="blob-num js-line-number" data-line-number="21"></td>
                        <td id="file-make-static-gist-lisp-LC21" class="blob-code blob-code-inner js-file-line">             (css-url (subseq css-html <span class="pl-c1">45</span> (- (length css-html) <span class="pl-c1">4</span>)))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L22" class="blob-num js-line-number" data-line-number="22"></td>
                        <td id="file-make-static-gist-lisp-LC22" class="blob-code blob-code-inner js-file-line">             (style-sheet (drakma:http-request css-url))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L23" class="blob-num js-line-number" data-line-number="23"></td>
                        <td id="file-make-static-gist-lisp-LC23" class="blob-code blob-code-inner js-file-line">             <span class="pl-c">;; Remove 
                        and  from the html</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L24" class="blob-num js-line-number" data-line-number="24"></td>
                        <td id="file-make-static-gist-lisp-LC24" class="blob-code blob-code-inner js-file-line">             (escaped-html (subseq doc-part <span class="pl-c1">16</span> (- (length doc-part) <span class="pl-c1">4</span>)))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L25" class="blob-num js-line-number" data-line-number="25"></td>
                        <td id="file-make-static-gist-lisp-LC25" class="blob-code blob-code-inner js-file-line">             (html-nl (cl-ppcre:regex-replace-all <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-cce"></span>n<span class="pl-pds">&quot;</span></span> escaped-html nl-string))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L26" class="blob-num js-line-number" data-line-number="26"></td>
                        <td id="file-make-static-gist-lisp-LC26" class="blob-code blob-code-inner js-file-line">             (raw-html (cl-ppcre:regex-replace-all <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-cce"></span><span class="pl-pds">&quot;</span></span> html-nl <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-pds">&quot;</span></span>)))</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L27" class="blob-num js-line-number" data-line-number="27"></td>
                        <td id="file-make-static-gist-lisp-LC27" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">;; Print everything out</span></td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L28" class="blob-num js-line-number" data-line-number="28"></td>
                        <td id="file-make-static-gist-lisp-LC28" class="blob-code blob-code-inner js-file-line">        (<span class="pl-c1">format</span> <span class="pl-c1">t</span> <span class="pl-s"><span class="pl-pds">&quot;</span>~a~%<span class="pl-pds">&quot;</span></span> style-sheet)</td>
                      </tr>
                      <tr>
                        <td id="file-make-static-gist-lisp-L29" class="blob-num js-line-number" data-line-number="29"></td>
                        <td id="file-make-static-gist-lisp-LC29" class="blob-code blob-code-inner js-file-line">        (<span class="pl-c1">format</span> <span class="pl-c1">t</span> <span class="pl-s"><span class="pl-pds">&quot;</span>~a~%<span class="pl-pds">&quot;</span></span> raw-html)))))</td>
                      </tr>
                    </table>

                  </div>

                </div>
                
              </div>

            </div>
            <div class="gist-meta">
              <a href="https://gist.github.com/jl2/f61b8a09e87b05d0cde9/raw/5eb380fdb7b4ab23ab004736f71644a955f82e3d/make-static-gist.lisp" style="float:right">view raw</a>
              <a href="https://gist.github.com/jl2/f61b8a09e87b05d0cde9#file-make-static-gist-lisp">make-static-gist.lisp</a>
              hosted with &#10084; by <a href="https://github.com">GitHub</a>
            </div>
          </div>
        </div>
        
      </div>

    </div>

    <div class="pageBody">
      <div class="pageEntry">
        <div class="section_header">
          <span class="date">November 29, 2015</span>
          <span class="title">New Github Pages Site</span>
        </div>
        <p>
          I haven't really done anything with my GitHub pages site, except setup Octopress and publish one blog post.
          Every time I've wanted to add a new entry I've got distracted fucking with Octopress and Ruby and Jekyll
          and a bunch of other stuff I don't care to learn, and ended up losing my motivation
        </p>
        <p> 
          This time it happened again, and I've decided to just get rid of Octopress and Jekyll entirely and go back to raw HTML.  
          It won't be the trendiest, prettiest website on the internet, but at least I know how to use it, and it won't have random
          shit breaking requiring an hour of tinkering to figure out which of a million Ruby gems is broken or not installed.
        </p>
      </div>

    </div>
    <div class="pageBody">
      <div class="pageEntry">
        <div class="section_header">
          <span class="title">GPX Library</span>
          <span class="date">November 12, 2014</span>
        </div>
        <p>
          I recently wrote a small library, called <a href="https://github.com/jl2/gpxtools">gpxtools</a>,
          for processing <a href="https://en.wikipedia.org/wiki/GPS_Exchange_Format">GPX</a> track files in
          Common Lisp.
          </p> <p>
          It doesn't have many features yet, but right now it can read a GPX file and compute
          elevation gain, elevation loss, and the total distance of all the tracks in the file.
        </p>
        <p>
          Here is a sample usage from the REPL:
        </p>

        <div id="gist28475215" class="gist">
          <div class="gist-file">
            <div class="gist-data">
              <div class="js-gist-file-update-container js-task-list-container file-box">
                <div id="file-replsample-lisp" class="file">
                  

                  <div class="blob-wrapper data type-common-lisp">
                    <table class="highlight tab-size js-file-line-container" data-tab-size="8">
                      <tr>
                        <td id="file-replsample-lisp-L1" class="blob-num js-line-number" data-line-number="1"></td>
                        <td id="file-replsample-lisp-LC1" class="blob-code blob-code-inner js-file-line">* (ql:quickload &#39;gpxtools)</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L2" class="blob-num js-line-number" data-line-number="2"></td>
                        <td id="file-replsample-lisp-LC2" class="blob-code blob-code-inner js-file-line">   To <span class="pl-c1">load</span> <span class="pl-s"><span class="pl-pds">&quot;</span>gpxtools<span class="pl-pds">&quot;</span></span>:</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L3" class="blob-num js-line-number" data-line-number="3"></td>
                        <td id="file-replsample-lisp-LC3" class="blob-code blob-code-inner js-file-line">   <span class="pl-c1">Load</span> <span class="pl-c1">1</span> ASDF system:</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L4" class="blob-num js-line-number" data-line-number="4"></td>
                        <td id="file-replsample-lisp-LC4" class="blob-code blob-code-inner js-file-line">   gpxtools</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L5" class="blob-num js-line-number" data-line-number="5"></td>
                        <td id="file-replsample-lisp-LC5" class="blob-code blob-code-inner js-file-line">   <span class="pl-c">; Loading &quot;gpxtools&quot;</span></td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L6" class="blob-num js-line-number" data-line-number="6"></td>
                        <td id="file-replsample-lisp-LC6" class="blob-code blob-code-inner js-file-line">   .....</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L7" class="blob-num js-line-number" data-line-number="7"></td>
                        <td id="file-replsample-lisp-LC7" class="blob-code blob-code-inner js-file-line">   (GPXTOOLS)</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L8" class="blob-num js-line-number" data-line-number="8"></td>
                        <td id="file-replsample-lisp-LC8" class="blob-code blob-code-inner js-file-line">* (defparameter <span class="pl-smi">*gpx*</span></td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L9" class="blob-num js-line-number" data-line-number="9"></td>
                        <td id="file-replsample-lisp-LC9" class="blob-code blob-code-inner js-file-line">    (gpxtools:read-gpx <span class="pl-s"><span class="pl-pds">&quot;</span>/Users/jeremiah/gpx_tracks/precarious_climb.gpx<span class="pl-pds">&quot;</span></span>))</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L10" class="blob-num js-line-number" data-line-number="10"></td>
                        <td id="file-replsample-lisp-LC10" class="blob-code blob-code-inner js-file-line">Processing track: ACTIVE LOG</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L11" class="blob-num js-line-number" data-line-number="11"></td>
                        <td id="file-replsample-lisp-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">*GPX*</span></td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L12" class="blob-num js-line-number" data-line-number="12"></td>
                        <td id="file-replsample-lisp-LC12" class="blob-code blob-code-inner js-file-line">* (gpxtools:summarize <span class="pl-smi">*gpx*</span>)</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L13" class="blob-num js-line-number" data-line-number="13"></td>
                        <td id="file-replsample-lisp-LC13" class="blob-code blob-code-inner js-file-line">Total elevation gain: <span class="pl-c1">3567.</span>271946242661d0 feet</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L14" class="blob-num js-line-number" data-line-number="14"></td>
                        <td id="file-replsample-lisp-LC14" class="blob-code blob-code-inner js-file-line">Total elevation loss: -<span class="pl-c1">3538.</span>885209324304d0 feet</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L15" class="blob-num js-line-number" data-line-number="15"></td>
                        <td id="file-replsample-lisp-LC15" class="blob-code blob-code-inner js-file-line">Total elevation loss: <span class="pl-c1">6.</span>437161570619994d0 miles</td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L16" class="blob-num js-line-number" data-line-number="16"></td>
                        <td id="file-replsample-lisp-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">NIL</span></td>
                      </tr>
                      <tr>
                        <td id="file-replsample-lisp-L17" class="blob-num js-line-number" data-line-number="17"></td>
                        <td id="file-replsample-lisp-LC17" class="blob-code blob-code-inner js-file-line">* </td>
                      </tr>
                    </table>

                  </div>

                </div>
                
              </div>

            </div>
            <div class="gist-meta">
              <a href="https://gist.github.com/jl2/dc14aea03b3705646757/raw/1134e95922e4f4a232bdf32511f9a19fe8d35acd/replsample.lisp" style="float:right">view raw</a>
              <a href="https://gist.github.com/jl2/dc14aea03b3705646757#file-replsample-lisp">replsample.lisp</a>
              hosted with &#10084; by <a href="https://github.com">GitHub</a>
            </div>
          </div>
        </div>
        <p>
          So far the most challenging part of the project was the calculation of distances given
          points in latitude and longitude.  Doing so requires converting the coordinates to the
          <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">Universal Transverse
          Mercator (UTM)</a> coordinate system which uses meters, and then calculating the distance.
        </p>
        <p>
          I wasn't able to find a library to do the conversion for me, so I <a href="https://github.com/jl2/utm">wrote my
          own</a>, and requested it be added to QuickLisp.  It looks like everything went well, and it should be in the next release.
        </p>
        <p>
          I'm planning to add more features to the gpxtools library, and to clean up the code in a
          few spots.
        </p>
        <p>
          One thing I want to do is add generic traversal code and use it to simplify functions like
          distance, elevation-gain, and elevation-loss that iterate over the entire GPX data
          structure.
        </p>
        <p>
          Another thing I want to add is the ability to split tracks at a certain location and
          selectively write the results back to one or more files.  I'll often start my GPS at the
          beginning of a hike, but forget to turn off the GPS when I finish hiking and drive away.
          The result is a GPX track with 10 miles of hiking and 50 miles of driving.  I may even try
          to do the cut automatically, ending the track when it gets back to (or reasonably close
          to) the origin, and splitting the drive out into a second track automatically.
        </p>
      </div>
    </div>
  </body>
</html>
